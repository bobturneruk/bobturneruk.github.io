<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB R2019a"><title>Untitled</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: bold; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: normal; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S2 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px 4px 0px 0px; padding: 6px 45px 4px 13px; line-height: 17.2339992523193px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 14px;  }
.S3 { color: rgb(64, 64, 64); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 14px; overflow-x: hidden; line-height: 17.2339992523193px;  }
.embeddedOutputsErrorElement {min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
.embeddedOutputsWarningElement{min-height: 18px; max-height: 250px; overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
.diagnosticMessage-wrapper {font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {color: rgb(255,100,0); text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {color: rgb(230,0,0); text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart {white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {white-space: pre; word-wrap: initial; min-height: 18px; max-height: 250px; overflow: auto;}
.textElement,.rtcDataTipElement .textElement {padding-top: 3px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {min-height: 16px;}
.rightPaneElement .textElement {padding-top: 2px; padding-left: 9px;}
.S4 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: normal; text-align: left;  }
.S5 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.2339992523193px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 14px;  }
.S6 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.2339992523193px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 17.2339992523193px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h2  class = 'S0'><span>There and back again: A Matlab array's tale by Bob Turner</span></h2><div  class = 'S1'><span>Some talk the other day about porting and interoperability between Matlab and Python, so I thought I'd investigate passing arrays back and forth...</span></div><div  class = 'S1'><span>I'm doing this (against Mathworks advice) in an Anaconda environment. However, starting Matlab from the Anaconda command prompt seemed to work fine.</span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S2'><span style="white-space: pre;"><span>pyversion</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="A61D55DC" data-scroll-top="null" data-scroll-left="null" data-testid="output_0" data-width="916" data-height="73" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement">       version: '3.7'
    executable: 'C:\A_is_for\Anaconda3\python.exe'
       library: 'C:\A_is_for\Anaconda3\python37.dll'
          home: 'C:\A_is_for\Anaconda3'
      isloaded: 1</div></div></div></div></div><div  class = 'S4'><span>My plan, here, is to make a big array in Matlab, convert it to a Python numpy array, do some manipulation of it (transpose it a couple of times) and then turn it back into a Matlab array. By way of an experiment, I'll time each step.</span></div><div  class = 'S1'><span>Firstly, we make a Matlab array of random numbers:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>ml=rand(1e4,</span><span style="color: rgb(160, 32, 240);">'double'</span><span>);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre;"><span>toc;</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="6F2D7EE3" data-testid="output_1" data-width="916" data-height="18" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement">Elapsed time is 0.905154 seconds.</div></div></div></div></div><div  class = 'S4'><span>Next, out of curiosity, we do the same thing in Python:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>np=py.numpy.random.rand(int8(1e4),int8(1e4));</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre;"><span>toc;</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="6D5CB834" data-testid="output_2" data-width="916" data-height="18" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement">Elapsed time is 0.003176 seconds.</div></div></div></div></div><div  class = 'S4'><span>Surprisingly faster than Matlab. By a lot. Perhaps the array is being generated at a lower precision? Right at the bottom of this block we see that it's a float64 which I think is the same as a Matlab double:</span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S2'><span style="white-space: pre;"><span>np.dtype</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsVariableStringElement" uid="80070236" data-testid="output_3" data-width="916" data-height="384" data-hashorizontaloverflow="false" style="width: 946px; max-height: 395px;"><div class="textElement"><div><span class="variableNameElement">ans = </span></div><div>  Python dtype with properties:

          alignment: [1×1 py.int]
               base: [1×1 py.numpy.dtype]
          byteorder: [1×1 py.str]
               char: [1×1 py.str]
              descr: [1×1 py.list]
             fields: [1×1 py.NoneType]
              flags: [1×1 py.int]
          hasobject: 0
    isalignedstruct: 0
          isbuiltin: [1×1 py.int]
           isnative: 1
           itemsize: [1×1 py.int]
               kind: [1×1 py.str]
           metadata: [1×1 py.NoneType]
               name: [1×7 py.str]
              names: [1×1 py.NoneType]
               ndim: [1×1 py.int]
                num: [1×1 py.int]
              shape: [1×0 py.tuple]
                str: [1×3 py.str]
           subdtype: [1×1 py.NoneType]
               type: [1×1 py.type]

    float64
</div></div></div></div></div></div><div  class = 'S4'><span>I'll transpose the array twice in Matlab (which should tax the computer but give me the same variable out as I put in:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>ml_t=ml';</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>ml_t=ml_t';</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre;"><span>toc;</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="88A6E6C9" data-testid="output_4" data-width="916" data-height="18" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement">Elapsed time is 0.840660 seconds.</div></div></div></div></div><div  class = 'S4'><span>...which I can check like this:</span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S2'><span style="white-space: pre;"><span>isequal(ml,ml_t)</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsVariableStringElement" uid="0AD19778" data-testid="output_5" data-width="916" data-height="34" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement"><div><span class="variableNameElement">ans = <span class="headerElement">logical</span></span></div><div>   1
</div></div></div></div></div></div><div  class = 'S4'><span>...and it is. Obviously. Next, I'll turn the Matlab array into a Python array:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>ml_np=py.numpy.array(ml);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre;"><span>toc;</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="C4A6D14D" data-testid="output_6" data-width="916" data-height="18" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement">Elapsed time is 0.183789 seconds.</div></div></div></div></div><div  class = 'S4'><span>Transpose twice as in Matlab:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>ml_np=ml_np.transpose;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>ml_np=ml_np.transpose;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre;"><span>toc;</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="1C463BAF" data-testid="output_7" data-width="916" data-height="18" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement">Elapsed time is 0.004867 seconds.</div></div></div></div></div><div  class = 'S4'><span>Convert back to Matlab:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre;"><span>tic;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre;"><span>ml_np_ml=double(ml_np);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S7'><span style="white-space: pre;"><span>toc;</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="FBA36553" data-testid="output_8" data-width="916" data-height="18" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement">Elapsed time is 0.791083 seconds.</div></div></div></div></div><div  class = 'S4'><span>...and test that the variable that's been converted to Python, transposed twice and converted back to Matlab is unchanged:</span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S2'><span style="white-space: pre;"><span>isequal(ml,ml_np_ml)</span></span></div><div  class = 'S3'><div class="inlineElement eoOutputWrapper embeddedOutputsVariableStringElement" uid="0A49498A" data-testid="output_9" data-width="916" data-height="34" data-hashorizontaloverflow="false" style="width: 946px; max-height: 261px;"><div class="textElement"><div><span class="variableNameElement">ans = <span class="headerElement">logical</span></span></div><div>   1
</div></div></div></div></div></div><div  class = 'S4'><span>Looks like it's survived the ordeal!</span></div><div  class = 'S1'><span>This is good news and suggests that calling Python from Matlab might be do-able.</span></div><div  class = 'S1'><span>What surprises me about this is that despite everything being called from Matlab, the Python operations seem to be going way faster. Could be I'm missing something crucial, here. Not generalisable! If so I'd love to hear about it at bob.turner.uk at gmail.com or @Bobatron on Twitter!</span></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% There and back again: A Matlab array's tale by Bob Turner
% Some talk the other day about porting and interoperability between Matlab 
% and Python, so I thought I'd investigate passing arrays back and forth...
% 
% I'm doing this (against Mathworks advice) in an Anaconda environment. However, 
% starting Matlab from the Anaconda command prompt seemed to work fine.

pyversion
%% 
% My plan, here, is to make a big array in Matlab, convert it to a Python numpy 
% array, do some manipulation of it (transpose it a couple of times) and then 
% turn it back into a Matlab array. By way of an experiment, I'll time each step.
% 
% Firstly, we make a Matlab array of random numbers:

tic;
ml=rand(1e4,'double');
toc;
%% 
% Next, out of curiosity, we do the same thing in Python:

tic;
np=py.numpy.random.rand(int8(1e4),int8(1e4));
toc;
%% 
% Surprisingly faster than Matlab. By a lot. Perhaps the array is being generated 
% at a lower precision? Right at the bottom of this block we see that it's a float64 
% which I think is the same as a Matlab double:

np.dtype
%% 
% I'll transpose the array twice in Matlab (which should tax the computer but 
% give me the same variable out as I put in:

tic;
ml_t=ml';
ml_t=ml_t';
toc;
%% 
% ...which I can check like this:

isequal(ml,ml_t)
%% 
% ...and it is. Obviously. Next, I'll turn the Matlab array into a Python array:

tic;
ml_np=py.numpy.array(ml);
toc;
%% 
% Transpose twice as in Matlab:

tic;
ml_np=ml_np.transpose;
ml_np=ml_np.transpose;
toc;
%% 
% Convert back to Matlab:

tic;
ml_np_ml=double(ml_np);
toc;
%% 
% ...and test that the variable that's been converted to Python, transposed 
% twice and converted back to Matlab is unchanged:

isequal(ml,ml_np_ml)
%% 
% Looks like it's survived the ordeal!
% 
% This is good news and suggests that calling Python from Matlab might be do-able.
% 
% What surprises me about this is that despite everything being called from 
% Matlab, the Python operations seem to be going way faster. Could be I'm missing 
% something crucial, here. Not generalisable! If so I'd love to hear about it 
% at bob.turner.uk at gmail.com or @Bobatron on Twitter!
##### SOURCE END #####
--></body></html>